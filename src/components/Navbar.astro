---
import { NAV_LINKS } from "../constants/strings/nav.strings.ts";
import { GLOBAL } from "../constants/strings/global.strings";
import Search from "./Search.astro";
---

<div class="drawer drawer-end">
  <input id="nav-drawer" type="checkbox" class="drawer-toggle" />

  <div class="drawer-content">
    <div class="navbar bg-base-100 w-full shadow-sm">
      <div class="flex w-full items-center justify-between">
        <div class="flex-1">
          <a href="/" class="btn btn-ghost text-xl"> {GLOBAL.site.xuehua} </a>
        </div>

        <!-- Desktop nav -->
        <div class="hidden gap-6 lg:flex">
          {
            NAV_LINKS.map((item) =>
              item.children ? (
                <div class="dropdown dropdown-end">
                  <div
                    tabindex="0"
                    role="button"
                    class="link link-hover cursor-pointer"
                  >
                    {item.label}
                  </div>
                  <ul
                    tabindex="0"
                    class="dropdown-content menu bg-base-200 rounded-box z-10 w-40 p-2 shadow"
                  >
                    {item.children.map((child) => (
                      <li>
                        <a href={child.href}>{child.label}</a>
                      </li>
                    ))}
                  </ul>
                </div>
              ) : (
                <a href={item.href} class="link link-hover">
                  {item.label}
                </a>
              ),
            )
          }
        </div>
        <!-- Mobile hamburger -->
        <div class="flex-none lg:hidden">
          <label for="nav-drawer" class="btn btn-square btn-ghost">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-6"
            >
              <path
                fill-rule="evenodd"
                d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"
                clip-rule="evenodd"></path>
            </svg>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile drawer -->
  <div class="drawer-side">
    <label for="nav-drawer" class="drawer-overlay"></label>
    <div
      class="bg-base-200 text-base-content menu min-h-full w-full items-start p-8 pt-16 text-2xl font-semibold"
    >
      <div class="flex w-full flex-row items-center justify-between pb-8">
        <span class="text-neutral flex text-3xl">
          {GLOBAL.site.xuehua}
        </span>
        <!-- close drawer button -->
        <label
          for="nav-drawer"
          aria-label="Close navigation"
          class="btn btn-ghost btn-square"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="size-10"
          >
            <path
              fill-rule="evenodd"
              d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z"
              clip-rule="evenodd"></path>
          </svg>
        </label>
      </div>

      <ul class="flex w-full flex-col gap-8">
        <li class="w-full"><Search /></li>
        <!--TODO: I hate the chevron here-->
        {
          NAV_LINKS.map((item) =>
            item.children ? (
              <li>
                <details>
                  <summary>{item.label}</summary>
                  <ul>
                    {item.children.map((child) => (
                      <li>
                        <a href={child.href}>{child.label}</a>
                      </li>
                    ))}
                  </ul>
                </details>
              </li>
            ) : (
              <li>
                <a href={item.href}>{item.label}</a>
              </li>
            ),
          )
        }
      </ul>
    </div>
  </div>
</div>

<script>
  const drawer = document.getElementById("nav-drawer");
  if (drawer instanceof HTMLInputElement) {
    document.querySelectorAll("[data-close-drawer]").forEach((el) => {
      el.addEventListener("click", () => {
        drawer.checked = false;
      });
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") drawer.checked = false;
    });
  }
</script>
